!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,runClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],2:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],3:[function(require,module,exports){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],4:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};return array.forEach(function(val,idx){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){base=" [Function"+(value.name?": "+value.name:"")+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(recurseTimes<0)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;i<l;++i)hasOwnProperty(value,String(i))?output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0)):output.push("");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;return output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||void 0===arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(/%[sdj%]/g,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];i<len;x=args[++i])isNull(x)||!isObject(x)?str+=" "+x:str+=" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(!0===process.noDeprecation)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":3,_process:1,inherits:2}],5:[function(require,module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(){function IEQ(selector){return this.selector=selector,this.dataModel={},this._coder=selector.encode(),this.subscriptions=[],this.dataConfig={criteria:{time:{start:null,end:null,range:null},robot:null,place:null},operator:"last",sensors:null,sampling:null},this}var DiyaSelector=d1.DiyaSelector,Logger=(require("util"),{log:function(message){console.log(message)},error:function(message){console.error(message)}});IEQ.prototype.getDataModel=function(){return this.dataModel},IEQ.prototype.getDataRange=function(){return this.dataModel.range},IEQ.prototype.DataConfig=function(newDataConfig){return newDataConfig?(this.dataConfig=newDataConfig,this):this.dataConfig},IEQ.prototype.DataOperator=function(newOperator){return newOperator?(this.dataConfig.operator=newOperator,this):this.dataConfig.operator},IEQ.prototype.DataSampling=function(numSamples){return numSamples?(this.dataConfig.sampling=numSamples,this):this.dataConfig.sampling},IEQ.prototype.DataTime=function(newTimeStart,newTimeEnd,newRange){return newTimeStart||newTimeEnd||newRange?(this.dataConfig.criteria.time.start=newTimeStart.getTime(),this.dataConfig.criteria.time.end=newTimeEnd.getTime(),this.dataConfig.criteria.time.range=newRange,this):{start:new Date(this.dataConfig.criteria.time.start),end:new Date(this.dataConfig.criteria.time.end),range:new Date(this.dataConfig.criteria.time.range)}},IEQ.prototype.DataRobotIds=function(robotIds){return robotIds?(this.dataConfig.criteria.robot=robotIds,this):this.dataConfig.criteria.robot},IEQ.prototype.DataPlaceIds=function(placeIds){return placeIds?(this.dataConfig.criteria.placeId=placeIds,this):this.dataConfig.criteria.place},IEQ.prototype.getDataByName=function(sensorNames){var data=[];for(var n in sensorNames)data.push(this.dataModel[sensorNames[n]]);return data},IEQ.prototype.updateData=function(callback,dataConfig){this._updateData(callback,dataConfig,"DataRequest")},IEQ.prototype._updateData=function(callback,dataConfig,funcName){var that=this;dataConfig&&this.DataConfig(dataConfig),this.selector.request({service:"ieq",func:funcName,data:{data:JSON.stringify(that.dataConfig)},obj:{path:"/fr/partnering/Ieq",interface:"fr.partnering.Ieq"}},function(dnId,err,data){return data=JSON.parse(data),err?void("string"==typeof err?Logger.error("Recv err: "+err):"object"==(void 0===err?"undefined":_typeof(err))&&"string"==typeof err.name&&(callback(null,err.name),"string"==typeof err.message&&Logger.error(err.message))):data&&data.header&&data.header.error?(Logger.error("UpdateData:\n"+JSON.stringify(data.header.dataConfig)),void Logger.error("Data request failed ("+data.header.error.st+"): "+data.header.error.msg)):(that._getDataModelFromRecv(data),void callback(that.getDataModel()))})},IEQ.prototype._isDataModelWithNaN=function(){var sensorNan,dataModelNaN=!1;for(var n in this.dataModel)sensorNan=this.dataModel[n].data.reduce(function(nanPres,d){return nanPres&&isNaN(d)},!1),dataModelNaN=dataModelNaN&&sensorNan,Logger.log(n+" with nan : "+sensorNan+" ("+dataModelNaN+") / "+this.dataModel[n].data.length)},IEQ.prototype.getConfinementLevel=function(){return this.confinement},IEQ.prototype.getAirQualityLevel=function(){return this.airQuality},IEQ.prototype.getEnvQualityLevel=function(){return this.envQuality},IEQ.prototype.watch=function(config,callback){var that=this;config=config||{},config.timeRange=config.timeRange||"hours",config.category=config.cat||"ieq";var requestConfig={sampling:config.sampling||500,criteria:{time:{rangeUnit:config.timeRange},robots:config.robots},category:config.category,operators:["avg","min","max","stddev"]};this.selector.request({service:"ieq",func:"DataRequest",data:{data:JSON.stringify(requestConfig)},obj:{path:"/fr/partnering/Ieq",interface:"fr.partnering.Ieq"}},function(dnId,err,dataString){var data=JSON.parse(dataString);if(null!=err)return void("string"==typeof err?Logger.error("Recv err: "+err):"object"==(void 0===err?"undefined":_typeof(err))&&"string"==typeof err.name&&(callback(null,err.name),"string"==typeof err.message&&Logger.error(err.message)));callback(that._getDataModelFromRecv(data))});var subs=this.selector.subscribe({service:"ieq",func:"Second",data:{data:config},obj:{path:"/fr/partnering/Ieq",interface:"fr.partnering.Ieq"}},function(dnd,err,data){if(err)return that.closeSubscriptions(),that.subscriptionReqPeriod=that.subscriptionReqPeriod+1e3||1e3,that.subscriptionReqPeriod>3e5&&(that.subscriptionReqPeriod=3e5),void(subs.watchTentative=setTimeout(function(){that.watch(config,callback)},that.subscriptionReqPeriod));data=JSON.parse(data),that.subscriptionReqPeriod=0,callback(that._getDataModelFromRecv(data))});this.subscriptions.push(subs)},IEQ.prototype.closeSubscriptions=function(){for(var i in this.subscriptions)this.subscriptions[i].close(),clearTimeout(this.subscriptions[i].watchTentative);this.subscriptions=[]},IEQ.prototype.getCSVData=function(csvConfig,callback){var that=this;csvConfig&&"number"!=typeof csvConfig.nlines&&(csvConfig.nlines=void 0);var dataConfig=JSON.stringify({criteria:{time:{start:new Date(csvConfig.startTime).getTime(),end:new Date(csvConfig.endTime).getTime(),sampling:csvConfig.timeSample},places:[],robots:[]},sensors:csvConfig.sensorNames,sampling:csvConfig.nlines});this.selector.request({service:"ieq",func:"CsvDataRequest",data:{data:dataConfig},obj:{path:"/fr/partnering/Ieq",interface:"fr.partnering.Ieq"}},function(dnId,err,data){if(err)return void("string"==typeof err?Logger.error("Recv err: "+err):"object"==(void 0===err?"undefined":_typeof(err))&&"string"==typeof err.name&&(callback(null,err.name),"string"==typeof err.message&&Logger.error(err.message)));if("string"==typeof data)callback(data);else{if(data&&data.header&&data.header.error)return Logger.error("UpdateData:\n"+JSON.stringify(data.header.dataConfig)),void Logger.error("Data request failed ("+data.header.error.st+"): "+data.header.error.msg);that._getDataModelFromRecv(data),callback(that.getDataModel())}})},IEQ.prototype.getDataMapData=function(dataConfig,callback){this._updateData(callback,dataConfig,"DataRequest")},IEQ.prototype.getHeatMapData=function(sensorNames,time,sample,callback){var dataConfig={criteria:{time:{start:time.startEpoch,end:time.endEpoch,sampling:sample},places:[],robots:[]},sensors:sensorNames};console.warn('This function will be deprecated. Please use "getDataMapData" instead.'),this.getDataMapData(dataConfig,callback)},IEQ.prototype._getDataModelFromRecv=function(data){var dataModel=null;if(null!=data){for(var n in data)if("header"!=n&&"err"!=n){if(data[n].err&&data[n].err.st>0){Logger.error(n+" was in error: "+data[n].err.msg);continue}if(dataModel||(dataModel={}),dataModel[n]||(dataModel[n]={}),dataModel[n].range=data[n].range,dataModel[n].timeRange=data[n].timeRange,dataModel[n].label=data[n].label,dataModel[n].unit=data[n].unit,dataModel[n].precision=data[n].precision,dataModel[n].category=data[n].category,dataModel[n].zoomRange=[0,100],dataModel[n].confortRange=data[n].confortRange,dataModel[n].qualityConfig={indexRange:data[n].indexRange},dataModel[n].time=this._coder.from(data[n].time,"b64",8),dataModel[n].data=data[n].data?this._coder.from(data[n].data,"b64",4):data[n].avg?this._coder.from(data[n].avg.d,"b64",4):null,dataModel[n].qualityIndex=data[n].data?this._coder.from(data[n].index,"b64",4):data[n].avg?this._coder.from(data[n].avg.i,"b64",4):null,dataModel[n].robotId=this._coder.from(data[n].robotId,"b64",4),dataModel[n].robotId){var dicoRobot={};data.header.robots.forEach(function(el){dicoRobot[el.id]=el.name}),dataModel[n].robotId=dataModel[n].robotId.map(function(el){return dicoRobot[el]})}dataModel[n].placeId=this._coder.from(data[n].placeId,"b64",4),dataModel[n].x=null,dataModel[n].y=null,data[n].avg&&(dataModel[n].avg={d:this._coder.from(data[n].avg.d,"b64",4),i:this._coder.from(data[n].avg.i,"b64",4)}),data[n].min&&(dataModel[n].min={d:this._coder.from(data[n].min.d,"b64",4),i:this._coder.from(data[n].min.i,"b64",4)}),data[n].max&&(dataModel[n].max={d:this._coder.from(data[n].max.d,"b64",4),i:this._coder.from(data[n].max.i,"b64",4)}),data[n].stddev&&(dataModel[n].stddev={d:this._coder.from(data[n].stddev.d,"b64",4),i:this._coder.from(data[n].stddev.i,"b64",4)}),data[n].stddev&&(dataModel[n].stddev={d:this._coder.from(data[n].stddev.d,"b64",4),i:this._coder.from(data[n].stddev.i,"b64",4)}),data[n].x&&(dataModel[n].x=this._coder.from(data[n].x,"b64",4)),data[n].y&&(dataModel[n].y=this._coder.from(data[n].y,"b64",4)),dataModel[n].trend="mss"}}else Logger.error("No Data to read or header is missing !");return this.dataModel=dataModel,dataModel},DiyaSelector.prototype.IEQ=function(){return new IEQ(this)}}()},{util:4}]},{},[5]);
